function(x)ggsave(height = 6, width = 7, filename = paste("visuals/",x,".png",sep=""), plot=boxplot_list[[x]]))
# Single visual using cowplot.
full_plot <- plot_grid(plotlist = boxplot_list, nrow = 3, ncol = 2, labels = c("(a)","(b)","(c)","(d)","(e)","(f)"), scale = 0.9)
# Save full plot.
ggsave(plot = full_plot, filename = "visuals/full_boxplot.png", height = 14, width = 8)
# New grouped plot 14.05.20.
rd_stats_df <- bind_rows(rd_stats_list, .id = "crime_type")
full_plot_group <- ggplot(data = rd_stats_df) +
theme_bw() +
geom_boxplot(mapping = aes(x = crime_type,  y = abs_RD, fill = unit_type), colour = "black", size = 0.5,
position=position_dodge(width=1), width = 0.9) +
labs(y = "RD", x = "", fill = "") +
scale_fill_grey() +
scale_x_discrete(labels = c("All crime","Residence","Theft","Vehicle","Violent")) +
theme(legend.position = "top",
axis.title = element_text(size = 14),
axis.text = element_text(size = 14),
legend.key.size = unit(1.5, "cm"))
# Save full grouped plot
ggsave(plot = full_plot_group, filename = "visuals/full_boxplot_grouped.png", height = 10, width = 12)
# ggsave(plot = full_plot_group, filename = "visuals/full_boxplot_grouped_outliers.png", height = 10, width = 12)
# Function to calculate ARB stats for each crime type.
ARB_fun <- function(x){
x %>%
mutate(RB  = ((all_crimes / known)-1) * 100) %>%
group_by(unit_type) %>%
summarise(mean_RB    = mean(RB),
min_RB     = min(RB),
max_RB     = max(RB),
var_RB     = var(RB),
sd_RB      = sd(RB))
}
# Print stats.
lapply(rd_stats_list, ARB_fun)
# Load crimes known to Greater Manchester Police in 2011/12.
GMP_all <- read_csv(here("data/GMP_all.csv"))
# Merge spatial information of wards.
GMP_manc <- GMP_all %>%
left_join(LSOA_to_ward, by = c("lsoa11cd" = "LSOA")) %>%
filter(ladnm == "Manchester")
# Check to remove crimes which did not occurr within a Manchester LSOA.
#GMP_manc <- subset(GMP_all, LSOA.code %in% LSOA_to_ward$LSOA)
# Recode crime types to match categories used thus far.
GMP_manc <- GMP_manc %>%
mutate(Crime.type = recode(Crime.type,
"Anti-social behaviour"       = "other",
"Burglary"                    = "residence",
"Criminal damage and arson"   = "residence",
"Drugs"                       = "other",
"Other crime"                 = "other",
"Other theft"                 = "theft",
"Public disorder and weapons" = "other",
"Robbery"                     = "theft",
"Shoplifting"                 = "other",
"Vehicle crime"               = "vehicle",
"Violent crime"               = "violent")) %>%
filter(Crime.type == "residence" | Crime.type == "theft" | Crime.type == "vehicle" | Crime.type == "violent")
# Subset GMP_all by the different crime type categories.
GMP_all_list <- group_split(GMP_manc, Crime.type)
# Append total crimes to the list.
GMP_all_list <- c((GMP_all_list), list(GMP_manc))
# Rename elements of the list (order checked manually).
names(GMP_all_list) <- c("residence", "theft", "vehicle", "violent", "all_crimes")
#names(GMP_all_list) <- c("other", "residence_crime", "theft_crime", "vehicle_crime", "violent_crime", "all_crimes")
# Create sf point objects for each df in the list.
GMP_all_list_sf <- lapply(GMP_all_list, function(x)st_as_sf(x, coords = c(x = "Longitude", y = "Latitude"), crs = 4326))
# Transform each sf object in the list to BNG.
GMP_all_list_sf <- lapply(GMP_all_list_sf, function(x)st_transform(x, 27700))
# Load in spatial polygons at OA, LSOA, MSOA and Ward level.
ward_sf <- st_read("data/shapefiles/ward_manc_sf.shp")
msoa_sf <- st_read("data/shapefiles/msoa_manc_sf.shp")
lsoa_sf <- st_read("data/shapefiles/lsoa_manc_sf.shp")
oa_sf   <- st_read("data/shapefiles/oa_manc_sf.shp")
# Compile into list and name elements.
sf_list <- list(ward_sf, msoa_sf, lsoa_sf, oa_sf)
names(sf_list) <- c("ward_sf","msoa_sf","lsoa_sf","oa_sf")
# Set CRS.
sf_list <- lapply(sf_list, function(x)st_transform(x, 27700))
# We now want to counts points in polygons for each combinations of crime type points (GMP_manc_sf).
# and spatial scale polygons (sf_list).
# For now, split sf_list back into different objects.
list2env(sf_list,envir=.GlobalEnv)
# Aggregating point to polygons: Ward
ward_agg_list <- lapply(GMP_all_list_sf, function(x)ward_sf %>% mutate(count = lengths(st_intersects(ward_sf, x))))
# Aggregating point to polygons: MSOA
msoa_agg_list <- lapply(GMP_all_list_sf, function(x)msoa_sf %>% mutate(count = lengths(st_intersects(msoa_sf, x))))
# Aggregating point to polygons: LSOA
lsoa_agg_list <- lapply(GMP_all_list_sf, function(x)lsoa_sf %>% mutate(count = lengths(st_intersects(lsoa_sf, x))))
# Aggregating point to polygons: OA
oa_agg_list <- lapply(GMP_all_list_sf, function(x)oa_sf %>% mutate(count = lengths(st_intersects(oa_sf, x))))
# Remove 'other' category so the merge works. We don't use it for analysis but it was needed to get the total crime figure.
#oa_agg_list   <- oa_agg_list  [-1]
#lsoa_agg_list <- lsoa_agg_list[-1]
#msoa_agg_list <- msoa_agg_list[-1]
#ward_agg_list <- ward_agg_list[-1]
# Join this real police recorded crime data with our CSEW estimates.
# Split existing unit_list into list of lists.
unit_list_crime_types <- lapply(units_list, function(x)group_split(x, unit_type))
# The first element of each list is LAD, which we don't need for the comaprison. Keeping it would complicate the join.
unit_list_crime_types <- lapply(unit_list_crime_types, function(x) x[-1])
# Collate each list into global environment by crime type. First check what objects will be called.
names(unit_list_crime_types)
list2env(unit_list_crime_types,envir=.GlobalEnv)
# Extract each spatial scale (i.e. each element of 'unit_list_crime_types').
lsoa_gmp_df <- lapply(unit_list_crime_types, function(x) x[[1]])
msoa_gmp_df <- lapply(unit_list_crime_types, function(x) x[[2]])
oa_gmp_df   <- lapply(unit_list_crime_types, function(x) x[[3]])
ward_gmp_df <- lapply(unit_list_crime_types, function(x) x[[4]])
# Order elements of each list to we can use map2 easily to for joins.
oa_gmp_df   <- oa_gmp_df  [order(names(oa_gmp_df  ))]
lsoa_gmp_df <- lsoa_gmp_df[order(names(lsoa_gmp_df))]
msoa_gmp_df <- msoa_gmp_df[order(names(msoa_gmp_df))]
ward_gmp_df <- ward_gmp_df[order(names(ward_gmp_df))]
oa_agg_list   <- oa_agg_list  [order(names(oa_agg_list  ))]
lsoa_agg_list <- lsoa_agg_list[order(names(lsoa_agg_list))]
msoa_agg_list <- msoa_agg_list[order(names(msoa_agg_list))]
ward_agg_list <- ward_agg_list[order(names(ward_agg_list))]
# Rename code name in Ward for join.
ward_agg_list <- lapply(ward_agg_list, function(x) x %>% rename(code = wd18cd))
# Join all.
join_fun <- function(x, y){
right_join(x, y, by = c("unit" = "code"))
}
# Run through join on each list.
oa_compare_list   <- map2(oa_gmp_df  , oa_agg_list  , join_fun)
lsoa_compare_list <- map2(lsoa_gmp_df, lsoa_agg_list, join_fun)
msoa_compare_list <- map2(msoa_gmp_df, msoa_agg_list, join_fun)
ward_compare_list <- map2(ward_gmp_df, ward_agg_list, join_fun)
# Bind together for each descriptive stats. Note warning about geometry: not a problem for now, it just removes the
# spatial attributes but retains the geometry column.
oa_compare_df   <- bind_rows(oa_compare_list  , .id = "crime_type")
lsoa_compare_df <- bind_rows(lsoa_compare_list, .id = "crime_type")
msoa_compare_df <- bind_rows(msoa_compare_list, .id = "crime_type")
ward_compare_df <- bind_rows(ward_compare_list, .id = "crime_type")
# Aggregate crime data without searching points in polygons.
# At the Output Area level.
oa_agg <- GMP_manc %>%
group_by(Crime.type, oa11) %>%
summarise(GMP_agg = n()) %>%
filter(Crime.type != "other") %>%
rename(crime_type = Crime.type,
unit       = oa11)
oa_agg_all <- GMP_manc %>%
group_by(oa11) %>%
summarise(GMP_agg = n()) %>%
mutate(Crime.type = "all_crimes") %>%
select(Crime.type, oa11, GMP_agg) %>%
rename(crime_type = Crime.type,
unit       = oa11)
oa_agg <- bind_rows(oa_agg, oa_agg_all)
# At the LSOA level.
lsoa_agg <- GMP_manc %>%
group_by(Crime.type, lsoa11cd) %>%
summarise(GMP_agg = n()) %>%
rename(crime_type = Crime.type,
unit       = lsoa11cd)
lsoa_agg_all <- GMP_manc %>%
group_by(lsoa11cd) %>%
summarise(GMP_agg = n()) %>%
mutate(Crime.type = "all_crimes") %>%
select(Crime.type, lsoa11cd, GMP_agg) %>%
rename(crime_type = Crime.type,
unit       = lsoa11cd)
lsoa_agg <- bind_rows(lsoa_agg, lsoa_agg_all)
# At the MSOA level.
msoa_agg <- GMP_manc %>%
group_by(Crime.type, msoa11cd) %>%
summarise(GMP_agg = n()) %>%
rename(crime_type = Crime.type,
unit       = msoa11cd)
msoa_agg_all <- GMP_manc %>%
group_by(msoa11cd) %>%
summarise(GMP_agg = n()) %>%
mutate(Crime.type = "all_crimes") %>%
select(Crime.type, msoa11cd, GMP_agg) %>%
rename(crime_type = Crime.type,
unit       = msoa11cd)
msoa_agg <- bind_rows(msoa_agg, msoa_agg_all)
# At the Ward level.
wd_agg <- GMP_manc %>%
group_by(Crime.type, WD18CD) %>%
summarise(GMP_agg = n()) %>%
rename(crime_type = Crime.type,
unit       = WD18CD)
wd_agg_all <- GMP_manc %>%
group_by(WD18CD) %>%
summarise(GMP_agg = n()) %>%
mutate(Crime.type = "all_crimes") %>%
select(Crime.type, WD18CD, GMP_agg) %>%
rename(crime_type = Crime.type,
unit       = WD18CD)
wd_agg <- bind_rows(wd_agg, wd_agg_all)
# Bind togethe with main comparison dataset.
oa_compare_df <- oa_compare_df %>%
select(-unit_type) %>%
full_join(oa_agg, by = c("crime_type", "unit")) %>%
replace(is.na(.), 0)
lsoa_compare_df <- lsoa_compare_df %>%
full_join(lsoa_agg, by = c("crime_type", "unit")) %>%
replace(is.na(.), 0)
msoa_compare_df <- msoa_compare_df %>%
full_join(msoa_agg, by = c("crime_type", "unit")) %>%
replace(is.na(.), 0)
ward_compare_df <- ward_compare_df %>%
full_join(wd_agg, by = c("crime_type", "unit"))
View(oa_compare_df)
# Map RD across all scales
oa_compare_df <- oa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD))
lsoa_compare_df <- lsoa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD))
View(lsoa_compare_df)
msoa_compare_df <- msoa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD))
ward_compare_df <- ward_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD))
# Map RD across all scales 19.05.2020 David
oa_levels_df <- oa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD)) %>%
filter(crime_type == "theft")
lsoa_levels_df <- lsoa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD)) %>%
filter(crime_type == "theft")
msoa_levels_df <- msoa_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD)) %>%
filter(crime_type == "theft")
ward_levels_df <- ward_compare_df %>%
mutate(RD = ((known - all_crimes) / all_crimes) * 100,
abs_RD = abs(RD)) %>%
filter(crime_type == "theft")
oa_brks <- classIntervals(oa_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
lsoa_brks <- classIntervals(lsoa_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
msoa_brks <- classIntervals(msoa_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
wards_brks <- classIntervals(wards_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
oa_level_sf <- oa_level_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(all_crimes_cut = cut(all_crimes, all_crimes_brks$brks, include.lowest = T, dig.lab = 5),
known_cut      = cut(known     , known_brks$brks     , include.lowest = T, dig.lab = 5))
oa_levels_sf <- oa_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(all_crimes_cut = cut(all_crimes, all_crimes_brks$brks, include.lowest = T, dig.lab = 5),
known_cut      = cut(known     , known_brks$brks     , include.lowest = T, dig.lab = 5))
oa_levels_sf <- oa_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, oa_brks$brks, include.lowest = T, dig.lab = 5))
table(oa_levels_sf$RD_cut)
lsoa_levels_sf <- lsoa_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, lsoa_brks$brks, include.lowest = T, dig.lab = 5))
table(lsoa_levels_sf$RD_cut)
msoa_levels_sf <- msoa_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, msoa_brks$brks, include.lowest = T, dig.lab = 5))
table(msoa_levels_sf$RD_cut)
ward_levels_sf <- ward_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, ward_brks$brks, include.lowest = T, dig.lab = 5))
table(ward_levels_sf$RD_cut)
ward_brks <- classIntervals(wards_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
ward_brks <- classIntervals(ward_levels_df$abs_RD, n = 5, style="fixed",
fixedBreaks = c(0, 20, 40, 60, 80, 100))
ward_levels_sf <- ward_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, ward_brks$brks, include.lowest = T, dig.lab = 5))
table(ward_levels_sf$RD_cut)
map_fun <- function(x){
p1 <- ggplot(data = x) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = x) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = x) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = x) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
?map_fun
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
ggsave(plot = map_fun, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
temp <- map_fun()
ggsave(plot = temp, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "black") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "black") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "black") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "black") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
temp <- map_fun()
ggsave(plot = temp, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey", na.rm = TRUE)) +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey", na.rm = TRUE) +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
temp <- map_fun()
ggsave(plot = temp, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut, na.rm = TRUE), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
temp <- map_fun()
ggsave(plot = temp, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
drop_na(RD_cut) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
temp <- map_fun()
oa_levels_sf <- oa_levels_df %>%
st_as_sf(sf_column_name = "geometry") %>%
mutate(RD_cut = cut(abs_RD, oa_brks$brks, include.lowest = T, dig.lab = 5)) %>%
filter(!(is.na(abs_RD)))
table(oa_levels_sf$RD_cut)
map_fun <- function(x){
p1 <- ggplot(data = oa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p2 <- ggplot(data = lsoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p3 <- ggplot(data = msoa_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
p4 <- ggplot(data = ward_levels_sf) +
geom_sf(mapping = aes(fill = RD_cut), colour = "darkgrey") +
theme_minimal() +
scale_fill_grey(start=0.8, end=0.2) +
labs(fill = "") +
theme(legend.position = "bottom")
plot_grid(p1, p2, p3, p4, nrow = 2, labels = c("Output areas (RD%)","LSOAs (RD%)", "MSOAs (RD%)", "Wards (RD%)"))
}
temp <- map_fun()
ggsave(plot = temp, filename = "visuals/map_comaprison_RD.png", height = 24, width = 24, unit = "cm")
